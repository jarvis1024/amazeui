<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>form control</title>
    <script type="text/javascript" src="../assets/js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./inputs.css">
</head>
<body>
<span id="emoji1"></span>

<div style="/*max-width:900px*/">
    <table class="vj-form" cellspacing="0" cellpadding="0" data-vj-utf8 ><tbody>
        <tr>
            <td class="vj-title">
                <span class="vj-title-text">名</span>
            </td>

            <td>
                <div class="vj-ctrl-input vj-input-mutiple" data-vj-gourp="">
                    <span data-vj-title>名名</span>
                    <div data-vj-item>
                        <span data-vj-placeholder >hinter</span>
                        <span data-vj-counter >0/1</span>
                        <span data-vj-unit >个</span>
                        <input type="text" data-vj-name="ss" data-vj-max="5000" data-vj-min="20" data-vj-price data-vj-len="12" data-vj-tofixed="2">
                    </div>

                </div>
                <div class="vj-ctrl-input vj-input-mutiple" data-vj-gourp="">
                    <span data-vj-title>名名</span>
                    <div data-vj-item>
                        <span data-vj-placeholder >hinter</span>
                        <span data-vj-counter >0/1</span>
                        <span data-vj-unit >个</span>
                        <textarea type="text" data-vj-name="" data-vj-max="50" data-vj-min="20" data-vj-price></textarea>
                    </div>

                </div>


            </td>
        </tr>
    </tbody></table>
    
</div>
<script type="text/javascript">

    var vj_fm = (function(){
        var dubUtf8_REG = /[\u0080-\u07ff]/g ,
            trbUtf8_REG = /[\u0800-\uffff]/g ,
            dubByte_REG = /[^\x00-\xff]/g;


        this.checkLen = function( elm ){

            if( $(elm).closest("[data-vj-utf8]").length ){
                var elmVal = elm.value || $(elm).attr("data-vj-value") || "", 
                    limitLen = parseInt("0" + $(elm).attr("data-vj-len") ),
                    dubChr = elmVal.match( dubUtf8_REG ) || [],
                    trbChr = elmVal.match( trbUtf8_REG ) || [],
                    chrLen = trbChr.length*2 + dubChr.length + elmVal.length;

                $(elm).prevAll("[data-vj-counter]:first")
                    .html( 
                        parseInt(chrLen/3).toString() 
                      + "/" 
                      + parseInt(limitLen/3).toString() );

                return chrLen<=limitLen

            }else if( $(elm).closest("[data-vj-gbk]").length ){
                //
            }
        }

        return this
    })()
    $(document).ready(function(){

        $(".vj-ctrl-input input, .vj-ctrl-input textarea")
            .on("input", function(){
                if( this.value ){
                    $(this).prevAll("[data-vj-placeholder]:first").hide()

                    if( $(this).is("[data-vj-len]") ){
                        !checkLen( this )?
                            $(this).addClass("vj-err").prevAll("[data-vj-counter]:first").addClass("vj-err")
                          : $(this).removeClass("vj-err").prevAll("[data-vj-counter]:first").removeClass("vj-err")
                    }

                }else{
                    $(this).prevAll("[data-vj-placeholder]:first").show()

                }
            })
            .on("change", function(){
                var thisVal = this.value
                if( $(this).is("[data-vj-max],[data-vj-min],[data-vj-price]") && isNaN( thisVal ) ){
                    thisVal = "0"
                }
                if( !thisVal.trim() || thisVal==0 ){
                    thisVal.toString().length ?
                        $(this).prevAll("[data-vj-placeholder]:first").hide()
                      : $(this).prevAll("[data-vj-placeholder]:first").show()
                    this.value = thisVal
                    return 0
                }

                if( $(this).is("[data-vj-max]") )
                    thisVal = Math.min( thisVal, $(this).attr("data-vj-max") )

                if( $(this).is("[data-vj-min]") )
                    thisVal = Math.max( thisVal, $(this).attr("data-vj-min") )

                if( $(this).is("[data-vj-price]")){
                    $(this)
                        .attr( "data-vj-value", parseInt( thisVal*100 ) )
                }
                if( $(this).is("[data-vj-tofixed]") ){
                    thisVal = parseFloat(thisVal).toFixed(2)
                }
                this.value = thisVal

            })
            .on("bulr", function(){
                // vj_fm.update( $(this).closest("data-vj-group") );
            })



        //CSS            
        $.each( $(".vj-ctrl-input input").closest("[data-vj-item]").has("[data-vj-unit]").find("input"), function(){

            $(this).css("padding-right","28px")

        } )

    })
</script>
</body>
</html>