<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>form control</title>
    <script type="text/javascript" src="../assets/js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./inputs.css">
</head>
<body>
<span id="emoji1"></span>

<div style="/*max-width:900px*/">
    <table class="vj-form" cellspacing="0" cellpadding="0" data-vj-utf8 ><tbody>
        <tr>
            <td class="vj-name">
                <span class="vj-title-text">名</span>
            </td>

            <td>
                <div class="vj-ctrl vj-ctrl-input vj-input-mutiple" data-vj-gourp="">
                    <div class="vj-ctrl-item" data-vj-index="">
                        <span data-vj-title>名名</span>
                        <div data-vj-elm>
                            <span data-vj="placeholder" >hinter</span>
                            <span data-vj="counter" >0/1</span>
                            <span data-vj="unit" >个</span>
                            <input type="text" data-vj-name="ss" data-vj-max="5000" data-vj-min="20" data-vj-price data-vj-len="12" data-vj-express="parseFloat({{}}).toFixed(2)">
                        </div>
                        <p data-vj-text >
                            <span class="vj-alert">123</span>
                            <span class="vj-describe">123</span>
                        </p>
                    </div>
                
                </div>

                <div class="vj-ctrl vj-ctrl-input vj-input-mutiple" data-vj-gourp="">
                    <div class="vj-ctrl-item" data-vj-index="1">
                        <span data-vj-title>名1</span>
                        <div data-vj-elm>
                            <span data-vj="unit" >个</span>
                            <input type="text" data-vj-name="" style="width:80px;" >
                        </div>
                        <p data-vj-text >
                            <span class="vj-alert">123</span>
                            <span class="vj-describe">123</span>
                        </p>
                    </div>

                    <div class="vj-ctrl-item" data-vj-index="2">
                        <span data-vj-title>名2</span>
                        <div data-vj-elm>
                            <span data-vj="unit" >个</span>
                            <input type="text" data-vj-name="" style="width:80px;" >
                        </div>
                        <p data-vj-text >
                            <span class="vj-alert">123</span>
                            <span class="vj-describe">123</span>
                        </p>
                    </div>

                    <div class="vj-ctrl-item" data-vj-index="3">
                        <span data-vj-title>名3</span>
                        <div data-vj-elm>
                            <span data-vj="unit" >个</span>
                            <input type="text" data-vj-name="" style="width:80px;" >
                        </div>
                        <div data-vj-text >
                            <span class="vj-alert">123</span>
                            <span class="vj-describe">123</span>
                        </div>
                    </div>
                </div>

            </td>
        </tr>
        <tr>
            <td class="vj-name">
                <span class="vj-title-text">名</span>
            </td>

            <td>
                <div class="vj-ctrl vj-ctrl-input vj-input-single" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="">
                        <span data-vj-title>field_name_cn</span>
                        <div data-vj-elm>
                            <span data-vj="placeholder">{{ PHOLDER }}</span>
                            <span data-vj="unit">{{ UNIT }}</span>
                            <span data-vj="counter">0/{{ LEN /3 }}</span>
                            <!-- if "USE" = input -->
                            <input 
                                type="text"

                                data-vj-name="field_name"
                                data-vj-LEN=" LEN "
                                data-vj-max=" MAX "
                                data-vj-min=" MIN "
                                data-vj-format=" FORMAT "
                                FORMAT:
                                    data-vj-price
                                    data-vj-date
                                    data-vj-rate
                                    data-vj-
                                EXPRES:
                                    data-vj-express

                                 >
                            <!-- if "USE" = text -->
                            <!-- <textarea data-vj-nam="" data-vj-len=""> -->
                        </div>
                        <p data-vj-text>
                            <span class="vj-alert">alert!</span>
                            <span class="vj-describe">describer</span>
                            
                        </p>                        
                    </div>
                    
                </div>


                <div class="vj-ctrl vj-ctrl-select vj-select-matrix" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="" >
                        <span data-vj-title>Title</span>
                        <div data-vj-elm data-vj-name="" data-vj-value="" >
                            <span data-vj="viewer"></span>
                            <span data-vj="text">select-matrix</span>
                            <div data-vj-select="matrix" >
                                <span data-vj-data="Color010" data-vj-bgcolor >Color010</span>
                                <span data-vj-data="Color020" data-vj-bgcolor >Color020</span>
                                <span data-vj-data="Color030" data-vj-bgcolor >Color030</span>
                                <span data-vj-data="Color040" data-vj-bgcolor >Color040</span>
                                <span data-vj-data="Color050" data-vj-bgcolor >Color050</span>
                                <span data-vj-data="Color060" data-vj-bgcolor >Color060</span>
                                <span data-vj-data="Color070" data-vj-bgcolor >Color070</span>
                                <span data-vj-data="Color080" data-vj-bgcolor >Color080</span>
                                <span data-vj-data="Color081" data-vj-bgcolor >Color081</span>
                                <span data-vj-data="Color082" data-vj-bgcolor >Color082</span>
                                <span data-vj-data="Color090" data-vj-bgcolor >Color090</span>
                                <span data-vj-data="Color100" data-vj-bgcolor >Color100</span>
                                <span data-vj-data="Color101" data-vj-bgcolor >Color101</span>
                                <span data-vj-data="Color102" data-vj-bgcolor >Color102</span>
                            </div>
                        </div>
                        
                    </div>
                    
                </div>

                <div class="vj-ctrl vj-ctrl-select vj-selet-row" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="">
                        <span data-vj-title>Title</span>
                        <div data-vj-elm data-vj-name="" data-vj-value="">
                            <span data-vj="viewer"></span>
                            <span data-vj="text">selet-row</span>
                            <div data-vj-select="row">
                                <span data-vj-data="value1">item1</span>
                                <span data-vj-data="value2">item2</span>
                                <span data-vj-data="value3">item3</span>
                                <span data-vj-data="value4">item4</span>
                                <span data-vj-data="value5">item5</span>
                                <span data-vj-data="value6">item6</span>
                                <span data-vj-data="value7">item7</span>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="vj-ctrl vj-ctrl-check vj-check-single" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="" >
                        <span data-vj-title>Title</span>
                        <div data-vj-elm data-vj-name="" data-vj-value="" data-vj-check="single">
                            <span data-vj-data="value1" class="vj-checked" >item1</span>
                            <span data-vj-data="value2" >item2</span>
                            <span data-vj-data="value3" >item3</span>
                            <span data-vj-data="value4" >item4</span>
                        </div>
                        
                    </div>
                </div>


                <div class="vj-ctrl vj-ctrl-check vj-check-mutiple" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="" >
                        <span data-vj-title>Title</span>
                        <div data-vj-elm data-vj-name="" data-vj-value="" data-vj-check="mutiple">
                            <span data-vj-data="value1" class="vj-checked" >item1</span>
                            <span data-vj-data="value2" >item2</span>
                            <span data-vj-data="value3" >item3</span>
                            <span data-vj-data="value4" >item4</span>
                        </div>
                        
                    </div>
                </div>

                <div class="vj-ctrl vj-ctrl-check vj-check-mutiple" data-vj-group="">
                    <div class="vj-ctrl-item" data-vj-index="" >
                        <span data-vj-title>Title</span>
                        <div data-vj-elm data-vj-check="mutiple">
                            <span data-vj-data="value1" class="vj-checked" data-vj-name="" data-vj-value="" >item1</span>
                        </div>
                        
                    </div>
                </div>


                <div class="vj-ctrl vj-ctrl-button vj-button-upload">
                    <div class="vj-ctrl-item">
                        <span data-vj-title >Title</span>
                        <div data-vj-elm>
                            <button data-vj-action="FUNCTION_NAME">上传</button>
                        </div>
                        <div data-vj-text>
                            <span class="vj-describe">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
                            
                        </div>
                    </div>
                </div>                
            </td>
        </tr>

    </tbody></table>
    
</div>
<script type="text/javascript">


    (function(){

        var vj = (function(){
            var ss;

            var vj_fn = (function(){
                var dubUtf8_REG = /[\u0080-\u07ff]/g ,
                    trbUtf8_REG = /[\u0800-\uffff]/g ,
                    dubByte_REG = /[^\x00-\xff]/g;


                return {
                    checkLen : function( elm ){

                        if( $(elm).closest("[data-vj-utf8]").length ){
                            var elmVal = elm.value || $(elm).attr("data-vj-value") || "", 
                                limitLen = parseInt("0" + $(elm).attr("data-vj-len") ),
                                dubChr = elmVal.match( dubUtf8_REG ) || [],
                                trbChr = elmVal.match( trbUtf8_REG ) || [],
                                chrLen = trbChr.length*2 + dubChr.length + elmVal.length;

                            $(elm).siblings("[data-vj=counter]:first")
                                .html( 
                                    parseInt(chrLen/3).toString() 
                                  + "/" 
                                  + parseInt(limitLen/3).toString() );

                            return chrLen<=limitLen

                        }else if( $(elm).closest("[data-vj-gbk]").length ){
                            //
                        }
                    },

                    nWindow : function(){
                        var thisDom = 
                            '<div class=""> '
                        +   '<div> '
                    }

                }
            })();

            return {

                input:{
                    onInput: function(){
                        if( this.value ){
                            $(this).siblings("[data-vj=placeholder]:first").hide()

                            if( $(this).is("[data-vj-len]") ){
                                !vj_fn.checkLen( this )?
                                    $(this).closest("[data-vj-elm]").addClass("vj-err vj-err-len")
                                  : $(this).closest("[data-vj-elm]").removeClass("vj-err vj-err-len")
                            }

                        }else{
                            $(this).siblings("[data-vj=placeholder]:first").show()

                        }
                    } ,
                    onChange: function(){
                        var thisVal = this.value
                        if( $(this).is("[data-vj-max],[data-vj-min],[data-vj-price]") && isNaN( thisVal ) ){
                            thisVal = "0"
                        }
                        if( !thisVal.trim() || thisVal==0 ){
                            thisVal.toString().length ?
                                $(this).siblings("[data-vj=placeholder]:first").hide()
                              : $(this).siblings("[data-vj=placeholder]:first").show()
                            this.value = thisVal
                            return 0
                        }

                        if( $(this).is("[data-vj-max]") )
                            thisVal = Math.min( thisVal, $(this).attr("data-vj-max") )

                        if( $(this).is("[data-vj-min]") )
                            thisVal = Math.max( thisVal, $(this).attr("data-vj-min") )

                        if( $(this).is("[data-vj-price]") )
                            $(this).attr( "data-vj-value", parseInt( thisVal*100 ) )

                        if( $(this).is("[data-vj-tofixed]") )
                            thisVal = parseFloat(thisVal).toFixed(2)

                        if( $(this).is("[data-vj-express]") )
                            thisVal = eval( $(this).attr("data-vj-express").replace(/\{\{\}\}/g , thisVal ) )

                        if( thisVal!==NaN && thisVal!==null )
                            this.value = thisVal;

                    } ,
                    onBlur: function(){
                        // vj_fm.update( $(this).closest("data-vj-group") );
                    }

                },

                select: {
                    onClick: function(e){
                        if( $(e.target).is("[data-vj-data]") ){
                            if( $(this).has("[data-vj-select='matrix']") ){
                                var func = "css"; 
                                var pram = 
                                    $(e.target).is("[data-vj-bgcolor]") ?
                                    { backgroundColor: $(e.target).attr("data-vj-bgcolor"), width: 20 }
                                    :{ width: 0 }
                            }else{
                                var func = "html";
                                var pram = 
                                    $(e.target).is("[data-vj-html]") ?
                                    $(e.target).attr("data-vj-html")
                                    :""
                            }

                            $(this)
                                .attr("data-vj-value", $(e.target).attr("data-vj-data") )
                                .find("[data-vj=text]")
                                    .html( $(e.target).html() )
                                    .siblings("[data-vj=viewer]")[func](pram)
                                   
                            $(this).trigger("change")
                        }
                        $(this).toggleClass("vj-active").find("[data-vj-select]").slideToggle(100);
                    },
                    onChange: function(){
                        // vj_fm.update( $(this).closest("data-vj-group") );

                    }

                },

                check:{
                    onClick: function(){
                        $(this).closest('[data-vj-check]').attr("data-vj-check")==="single" ?
                            $(this).addClass("vj-checked").siblings().removeClass("vj-checked")
                          : $(this).toggleClass("vj-checked");

                        var arrChecked = new Array();
                        $.each( 
                            $(this).is(".vj-checked") ?
                                $(this).siblings(".vj-checked").add(this)
                              : $(this).siblings(".vj-checked")
                            , function(idx, elm){
                                arrChecked.push("\"" + $(elm).attr("data-vj-data") + "\"");
                        })

                        $(this).is("[data-vj-name]") ?
                            $(this).attr("data-vj-value", $(this).is(".vj-checked") )
                          : $(this).closest("[data-vj-name]").attr("data-vj-value", arrChecked.join(",") )

                        $(this).trigger("change")
                    },
                    onChange: function(){
                        // vj_fm.update( $(this).closest("data-vj-group") );
                    }
                }

            }

        })();


        // $.fn.extend({
        //     vj.alert: function(msg){
        //             $(this).closest(".vj-ctrl-item").find("[data-vj-text] .vj-alert").html(msg).show()
        //         }
        // })


        $(".vj-ctrl-input input, .vj-ctrl-input textarea")
            .on("input", vj.input.onInput )
            .on("change", vj.input.onChange )
            .on("bulr", vj.input.onBlur )
            .fn = {
                alert : function (msg){
                    console.log("alert:msg" + msg)
                }
            } 

        $(".vj-ctrl-select [data-vj-elm] ")
            .on("click", vj.select.onClick )
            .on("change", vj.select.onChange )

        $(".vj-ctrl-check [data-vj-elm] *")
            .on("click", vj.check.onClick )
            .on("change", vj.check.onChange )

        //CSS            
        $.each( $(".vj-ctrl-input input").siblings("[data-vj=unit],[data-vj=counter]"), function(){
            $(this)
                .siblings("input")
                    .css( "padding-right", (this.offsetWidth+8).toString() + "px" )

        } )
        $.each( $(".vj-select-matrix [data-vj-bgcolor]"), function(){
            $(this)
                .attr( "data-vj-bgcolor", $(this).css("background-color") )
                .css("font-size",0)

        } )

    })()
</script>
</body>
</html>